!function(d){window._gtm_templates=window._gtm_templates||{tools:{}},window._gtm_templates.tools.buildQuery=function(e){if("string"==typeof e)return e;var t=[];for(var a in e)e.hasOwnProperty(a)&&t.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));return t.join("&")},d(".filter").on("click",function(){var a=d("[data-filter-tag-type]:checked").map(function(){return d(this).data("filterTagType")}).get(),n=d("[data-filter-tag-category]:checked").map(function(){return d(this).data("filterTagCategory")}).get();0<n.length||0<a.length?d(".card[data-product-type]").each(function(){var e=d(this).data("productType").toLowerCase(),t=d(this).data("productCategory");-1<n.indexOf(t)&&-1<a.indexOf(e)?d(this).show():d(this).hide()}):d(".card[data-product-type]").show(),d(".results-count").text(d("div.card[data-eec-action]:visible").length)}),d("#sortFilter").on("changed.bs.select",function(){var e="home page"===window.dataLayer[0].page.type?"/?":"/search?",t=JSON.parse(JSON.stringify(window.dataLayer[0].page.filters)),a=d("option:selected",this).data("filterSort");t.sort=a||"views",location.href=e+window._gtm_templates.tools.buildQuery(t)}),d("#categoryFilter").on("changed.bs.select",function(){var e=JSON.parse(JSON.stringify(window.dataLayer[0].page.filters)),t=d("#categoryFilter option:selected").map(function(){return d(this).data("filterCategory")}).get().join(",");if("templates listing page"!==window.dataLayer[0].page.type){var a="home page"===window.dataLayer[0].page.type?"/?":"/search?";-1<e.categories.indexOf("all")&&e.categories.splice(e.categories.indexOf("all")),e.categories=t||"all",location.href=a+window._gtm_templates.tools.buildQuery(e)}else location.href=["","categories",t,""].join("/")}),d("#tagTypeFilter").on("changed.bs.select",function(){var e="home page"===window.dataLayer[0].page.type?"/?":"/search?",t=JSON.parse(JSON.stringify(window.dataLayer[0].page.filters));-1<t.templateTypes.indexOf("all")&&t.templateTypes.splice(t.templateTypes.indexOf("all"));var a=d("#tagTypeFilter option:selected").map(function(){return d(this).data("filterTagType")}).get().join(",");t.templateTypes=a||"all",location.href=e+window._gtm_templates.tools.buildQuery(t)}),d("#searchGo").on("mousedown",function(){var e="home page"===window.dataLayer[0].page.type?"/?":"/search?",t=JSON.parse(JSON.stringify(window.dataLayer[0].page.filters));-1<t.templateTypes.indexOf("all")&&t.templateTypes.splice(t.templateTypes.indexOf("all"));var a=d("#tagTypeFilter option:selected").map(function(){return d(this).data("filterTagType")}).get().join(",");t.templateTypes=a||"all",t.query=[d("#query").val()],location.href=e+window._gtm_templates.tools.buildQuery(t)}),d("#install-template").on("click",function(){window._sw_step_1_query=!0,d(".modal .modal-title").text("Custom Template Installation Process"),d("#smartwizard").smartWizard({selected:0,theme:"arrows",transitionEffect:"fade",autoAdjustHeight:!0,backButtonSupport:!1,toolbarSettings:{toolbarPosition:"bottom",toolbarExtraButtons:[],showPreviousButton:!1},anchorSettings:{anchorClickable:!1,enableAllAnchors:!1,markDoneStep:!0,enableAnchorOnDoneStep:!0},backButtonSupport:!1,contentCache:!1,disabledSteps:[]}),d(document).on("leaveStep","#smartwizard",function(e,t,a,n){return"forward"===n&&0===a&&0===d('[name="accountId"]:checked').length?(alert("You need to select an account"),!1):"forward"===n&&1===a&&0===d('[name="containerId"]:checked').length?(alert("You need to select a container"),!1):"forward"!==n||2!==a||0!==d('[name="workspaceId"]:checked').length||(alert("You need to select a workspace"),!1)})}),d(document).on("showStep","#smartwizard",function(e,t,a,n){var o=[1*new Date,Math.random().toString(36).substring(7)].join("");if(0===a&&!0===window._sw_step_1_query&&(d("#step-1").html('<img src="https://loading.io/spinners/bricks/index.block-rotate-loading-gif.svg"></img>'),d.getJSON("/api/gtm/getAccounts?cb="+o,function(e){var t=[];e.forEach(function(e){t.push('<div class="radio radio-info"><input data-account-id="'+e.accountId+'" data-account-name="'+e.name+'" class="form-check-input" type="radio" name="accountId" id="accountId_'+e.accountId+'" value="'+e.accountId+'">                <label class="form-check-label" for="accountId_'+e.accountId+'">'+e.name+" <small>( "+e.accountId+" )</small></label></div>")}),d("#step-1").html(t.join(""))}).fail(function(e){d("#step-1").html("Something went wrong. Try again")})),1===a&&"forward"===n&&d('[name="accountId"]:checked').val()){var i=d('[name="accountId"]:checked').val().toString();d("#step-2").html('<img src="https://loading.io/spinners/bricks/index.block-rotate-loading-gif.svg"></img>'),d.getJSON("/api/gtm/getContainers/"+i+"?cb="+o,function(e){var t=[];e.forEach(function(e){t.push('<div class="radio radio-info"><input data-container-id="'+e.containerId+'" data-container-name="'+e.name+'" data-container-public-id="'+e.publicId+'" class="form-check-input" type="radio" name="containerId" id="containerId_'+e.containerId+'" value="'+e.containerId+'">          <label class="form-check-label" for="containerId_'+e.containerId+'">'+e.name+" <small>( "+e.publicId+" )</small></label></div>")}),d("#step-2").html(t.join(""))}).fail(function(e){d("#step-2").html("Something went wrong. Try again")})}if(2===a&&"forward"===n&&d('[name="accountId"]:checked').val()&&d('[name="containerId"]:checked').val()){i=d('[name="accountId"]:checked').val().toString();var r=d('[name="containerId"]:checked').val().toString();d("#step-3").html('<img src="https://loading.io/spinners/bricks/index.block-rotate-loading-gif.svg"></img>'),d.getJSON("/api/gtm/getWorkSpaces/"+i+"/"+r+"?cb="+o,function(e){var t=[];e.forEach(function(e){t.push('<div class="radio radio-info"><input data-workspace-id="'+e.workspaceId+'" data-workspace-name="'+e.name+'"  class="form-check-input" type="radio" name="workspaceId" id="workspaceId_'+e.workspaceId+'" value="'+e.workspaceId+'"><label class="form-check-label" for="workspaceId_${e.workspaceId}">'+e.name+"</label></div>")}),d("#step-3").html(t.join(""))}).fail(function(e){d("#step-3").html("Something went wrong. Try again")})}if(3===a&&(d("#review-account-name").text(d('[name="accountId"]:checked').data("accountName")),d("#review-container-name").html(d('[name="containerId"]:checked').data("containerName")+'<span class="label label-default">'+d('[name="containerId"]:checked').data("containerPublicId")+"</span>"),d("#review-workspace-name").text(d('[name="workspaceId"]:checked').data("workspaceName")),d(".sw-btn-next").text("INSTALL")),4===a&&"forward"===n){var c=dataLayer[0].template.id,s=(i=d('[name="accountId"]:checked').data("accountId"),r=d('[name="containerId"]:checked').data("containerId"),d('[name="workspaceId"]:checked').data("workspaceId"));d(".sw-btn-next").hide(),d("#step-5").html('<img src="https://loading.io/spinners/bricks/index.block-rotate-loading-gif.svg"></img>'),i&&r&&s||d("#step-5").html("Something went wrong. Try again"),d.getJSON("/api/gtm/installTemplate/"+c+"/"+i+"/"+r+"/"+s+"/?cb="+o,function(e){d("#step-5").html("<pre>"+JSON.stringify(e,null,"\t")+"</pre>")}).fail(function(e){d("#step-5").html("Something went wrong. Try again")})}}),d("#exampleModal").on("hidden.bs.modal",function(){window._sw_step_1_query=!1,d("#smartwizard").smartWizard("reset"),document.location.hash&&-1<document.location.hash.indexOf("#step")&&history.pushState("",document.title,window.location.pathname+window.location.search)});function n(e){if(("https://www.gtmtemplates.com"===e.origin||"http://localhost:8080"===e.origin)&&"google-auth-popup"===e.source.name){var t=new XMLHttpRequest,a="/api/session/login/"+e.data;t.open("GET",a,!0),t.onreadystatechange=function(){4===t.readyState&&200===t.status&&"success"===JSON.parse(t.response).status&&window.location.reload()},t.send()}}var e=document.querySelector("#signIn"),o=null,i=null;e&&e.addEventListener("click",function(){!function(e,t){window.removeEventListener("message",n);var a="toolbar=no,menubar=no,width=600,height=700,top=100,left=100";null===o||o.closed?o=window.open(e,t,a):null!==i?(o=window.open(e,t,a)).focus():o.focus(),window.addEventListener("message",n,!1),i=e}(window.__google_auth_url,"google-auth-popup")})}(window.jQuery);