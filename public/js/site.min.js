!function(l){window._gtm_templates=window._gtm_templates||{tools:{}},window._gtm_templates.tools.buildQuery=function(e){if("string"==typeof e)return e;var t=[];for(var a in e)e.hasOwnProperty(a)&&t.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));return t.join("&")},l(".filter").on("click",function(){var a=l("[data-filter-tag-type]:checked").map(function(){return l(this).data("filterTagType")}).get(),n=l("[data-filter-tag-category]:checked").map(function(){return l(this).data("filterTagCategory")}).get();0<n.length||0<a.length?l(".card[data-product-type]").each(function(){var e=l(this).data("productType").toLowerCase(),t=l(this).data("productCategory");-1<n.indexOf(t)&&-1<a.indexOf(e)?l(this).show():l(this).hide()}):l(".card[data-product-type]").show(),l(".results-count").text(l("div.card[data-eec-action]:visible").length)}),l("#sortFilter").on("changed.bs.select",function(){var e="home page"===window.dataLayer[0].page.type?"/?":"/search?",t=JSON.parse(JSON.stringify(window.dataLayer[0].page.filters)),a=l("option:selected",this).data("filterSort");t.sort=a||"views",location.href=e+window._gtm_templates.tools.buildQuery(t)}),l("#categoryFilter").on("changed.bs.select",function(){var e=JSON.parse(JSON.stringify(window.dataLayer[0].page.filters)),t=l("#categoryFilter option:selected").map(function(){return l(this).data("filterCategory")}).get().join(",");if("templates listing page"!==window.dataLayer[0].page.type){var a="home page"===window.dataLayer[0].page.type?"/?":"/search?";-1<e.categories.indexOf("all")&&e.categories.splice(e.categories.indexOf("all")),e.categories=t||"all",location.href=a+window._gtm_templates.tools.buildQuery(e)}else location.href=["","categories",t,""].join("/")}),l("#tagTypeFilter").on("changed.bs.select",function(){var e="home page"===window.dataLayer[0].page.type?"/?":"/search?",t=JSON.parse(JSON.stringify(window.dataLayer[0].page.filters));-1<t.templateTypes.indexOf("all")&&t.templateTypes.splice(t.templateTypes.indexOf("all"));var a=l("#tagTypeFilter option:selected").map(function(){return l(this).data("filterTagType")}).get().join(",");t.templateTypes=a||"all",location.href=e+window._gtm_templates.tools.buildQuery(t)}),l("#searchGo").on("mousedown",function(){var e="home page"===window.dataLayer[0].page.type?"/?":"/search?",t=JSON.parse(JSON.stringify(window.dataLayer[0].page.filters));-1<t.templateTypes.indexOf("all")&&t.templateTypes.splice(t.templateTypes.indexOf("all"));var a=l("#tagTypeFilter option:selected").map(function(){return l(this).data("filterTagType")}).get().join(",");t.templateTypes=a||"all",t.query=[l("#query").val()],location.href=e+window._gtm_templates.tools.buildQuery(t)}),l("#install-template").on("click",function(){window._sw_step_1_query=!0,l(".modal .modal-title").text("Custom Template Installation Process"),l("#smartwizard").smartWizard({selected:0,theme:"arrows",transitionEffect:"fade",autoAdjustHeight:!0,backButtonSupport:!1,toolbarSettings:{toolbarPosition:"bottom",toolbarExtraButtons:[],showPreviousButton:!1},anchorSettings:{anchorClickable:!1,enableAllAnchors:!1,markDoneStep:!0,enableAnchorOnDoneStep:!0},backButtonSupport:!1,contentCache:!1,disabledSteps:[]}),l(document).on("leaveStep","#smartwizard",function(e,t,a,n){return"forward"===n&&0===a&&0===l('[name="accountId"]:checked').length?(alert("You need to select an account"),!1):"forward"===n&&1===a&&0===l('[name="containerId"]:checked').length?(alert("You need to select a container"),!1):"forward"!==n||2!==a||0!==l('[name="workspaceId"]:checked').length||(alert("You need to select a workspace"),!1)})}),l(document).on("showStep","#smartwizard",function(e,t,a,n){var o=[1*new Date,Math.random().toString(36).substring(7)].join("");if(0===a&&!0===window._sw_step_1_query&&(l("#step-1").html('<img src="https://loading.io/spinners/bricks/index.block-rotate-loading-gif.svg"></img>'),l.getJSON("/api/gtm/getAccounts?cb="+o,function(e){var t=[];e.results.forEach(function(e){t.push('<div class="radio radio-info "><input data-account-id="'+e.accountId+'" data-account-name="'+e.name+'" class="form-check-input" type="radio" name="accountId" id="accountId_'+e.accountId+'" value="'+e.accountId+'">                <label class="form-check-label" for="accountId_'+e.accountId+'">'+e.name+" <small>( "+e.accountId+" )</small></label></div>")}),l("#step-1").html(t.join(""))}).fail(function(e){"001"===e.responseJSON.error_code?l("#step-1").html(e.responseJSON.message):l("#step-1").html("Something went wrong. Try again")})),1===a&&"forward"===n&&l('[name="accountId"]:checked').val()){var i=l('[name="accountId"]:checked').val().toString();l("#step-2").html('<img src="https://loading.io/spinners/bricks/index.block-rotate-loading-gif.svg"></img>'),l.getJSON("/api/gtm/getContainers/"+i+"?cb="+o,function(e){var t=[];e.results.forEach(function(e){t.push('<div class="radio radio-info"><input data-container-id="'+e.containerId+'" data-container-name="'+e.name+'" data-container-public-id="'+e.publicId+'" class="form-check-input" type="radio" name="containerId" id="containerId_'+e.containerId+'" value="'+e.containerId+'">          <label class="form-check-label" for="containerId_'+e.containerId+'">'+e.name+" <small>( "+e.publicId+" )</small></label></div>")}),l("#step-2").html(t.join(""))}).fail(function(e){l("#step-2").html(e.responseJSON.message)})}if(2===a&&"forward"===n&&l('[name="accountId"]:checked').val()&&l('[name="containerId"]:checked').val()){i=l('[name="accountId"]:checked').val().toString();var c=l('[name="containerId"]:checked').val().toString();l("#step-3").html('<img src="https://loading.io/spinners/bricks/index.block-rotate-loading-gif.svg"></img>'),l.getJSON("/api/gtm/getWorkSpaces/"+i+"/"+c+"?cb="+o,function(e){var t=[];e.results.forEach(function(e){t.push('<div class="radio radio-info"><input data-workspace-id="'+e.workspaceId+'" data-workspace-name="'+e.name+'"  class="form-check-input" type="radio" name="workspaceId" id="workspaceId_'+e.workspaceId+'" value="'+e.workspaceId+'"><label class="form-check-label" for="workspaceId_${e.workspaceId}">'+e.name+"</label></div>")}),l("#step-3").html(t.join(""))}).fail(function(e){l("#step-3").html(e.responseJSON.message)})}if(3===a&&(l("#review-account-name").text(l('[name="accountId"]:checked').data("accountName")),l("#review-container-name").html(l('[name="containerId"]:checked').data("containerName")+'<span class="label label-default">'+l('[name="containerId"]:checked').data("containerPublicId")+"</span>"),l("#review-workspace-name").text(l('[name="workspaceId"]:checked').data("workspaceName")),l(".sw-btn-next").text("INSTALL")),4===a&&"forward"===n){var r=dataLayer[0].template.id,s=(i=l('[name="accountId"]:checked').data("accountId"),c=l('[name="containerId"]:checked').data("containerId"),l('[name="workspaceId"]:checked').data("workspaceId"));l(".sw-btn-next").hide(),l("#step-5").html('<img src="https://loading.io/spinners/bricks/index.block-rotate-loading-gif.svg"></img>'),i&&c&&s||l("#step-5").html("Something went wrong. Try again"),l.getJSON("/api/gtm/installTemplate/"+r+"/"+i+"/"+c+"/"+s+"/?cb="+o,function(e){l("#step-5").html("Template "+e.results[0].name+" successfully imported")}).fail(function(e){l("#step-5").html(e.responseJSON.message)})}}),l("#exampleModal").on("hidden.bs.modal",function(){window._sw_step_1_query=!1,l("#smartwizard").smartWizard("reset"),document.location.hash&&-1<document.location.hash.indexOf("#step")&&history.pushState("",document.title,window.location.pathname+window.location.search)});function n(e){if(("https://www.gtmtemplates.com"===e.origin||"http://localhost:8080"===e.origin)&&"google-auth-popup"===e.source.name){var t=new XMLHttpRequest,a="/api/session/login/"+e.data;t.open("GET",a,!0),t.onreadystatechange=function(){4===t.readyState&&200===t.status&&"success"===JSON.parse(t.response).status&&window.location.reload()},t.send()}}var e=document.querySelector("#signIn"),o=null,i=null;window.openSignInWindow=function(e,t){window.removeEventListener("message",n);var a="toolbar=no,menubar=no,width=600,height=700,top=100,left=100";null===o||o.closed?o=window.open(e,t,a):null!==i?(o=window.open(e,t,a)).focus():o.focus(),window.addEventListener("message",n,!1),i=e},e&&l(document).on("click","#signIn",function(){openSignInWindow(window.__google_auth_url,"google-auth-popup")})}(window.jQuery);