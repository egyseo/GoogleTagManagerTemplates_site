!function(o){window._gtm_templates=window._gtm_templates||{tools:{}},window._gtm_templates.tools.buildQuery=function(e){if("string"==typeof e)return e;var t=[];for(var a in e)e.hasOwnProperty(a)&&t.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));return t.join("&")},o(".filter").on("click",function(){var a=o("[data-filter-tag-type]:checked").map(function(){return o(this).data("filterTagType")}).get(),n=o("[data-filter-tag-category]:checked").map(function(){return o(this).data("filterTagCategory")}).get();0<n.length||0<a.length?o(".card[data-product-type]").each(function(){var e=o(this).data("productType").toLowerCase(),t=o(this).data("productCategory");-1<n.indexOf(t)&&-1<a.indexOf(e)?o(this).show():o(this).hide()}):o(".card[data-product-type]").show(),o(".results-count").text(o("div.card[data-eec-action]:visible").length)}),o("#sortFilter").on("changed.bs.select",function(){var e="home page"===window.dataLayer[0].page.type?"/?":"/search?",t=JSON.parse(JSON.stringify(window.dataLayer[0].page.filters)),a=o("option:selected",this).data("filterSort");t.sort=a||"views",location.href=e+window._gtm_templates.tools.buildQuery(t)}),o("#categoryFilter").on("changed.bs.select",function(){var e=JSON.parse(JSON.stringify(window.dataLayer[0].page.filters)),t=o("#categoryFilter option:selected").map(function(){return o(this).data("filterCategory")}).get().join(",");if("templates listing page"!==window.dataLayer[0].page.type){var a="home page"===window.dataLayer[0].page.type?"/?":"/search?";-1<e.categories.indexOf("all")&&e.categories.splice(e.categories.indexOf("all")),e.categories=t||"all",location.href=a+window._gtm_templates.tools.buildQuery(e)}else location.href=["","categories",t,""].join("/")}),o("#tagTypeFilter").on("changed.bs.select",function(){var e="home page"===window.dataLayer[0].page.type?"/?":"/search?",t=JSON.parse(JSON.stringify(window.dataLayer[0].page.filters));-1<t.templateTypes.indexOf("all")&&t.templateTypes.splice(t.templateTypes.indexOf("all"));var a=o("#tagTypeFilter option:selected").map(function(){return o(this).data("filterTagType")}).get().join(",");t.templateTypes=a||"all",location.href=e+window._gtm_templates.tools.buildQuery(t)}),o("#searchGo").on("mousedown",function(){var e="home page"===window.dataLayer[0].page.type?"/?":"/search?",t=JSON.parse(JSON.stringify(window.dataLayer[0].page.filters));-1<t.templateTypes.indexOf("all")&&t.templateTypes.splice(t.templateTypes.indexOf("all"));var a=o("#tagTypeFilter option:selected").map(function(){return o(this).data("filterTagType")}).get().join(",");t.templateTypes=a||"all",t.query=[o("#query").val()],location.href=e+window._gtm_templates.tools.buildQuery(t)});function n(e){if(("https://www.gtmtemplates.com"===e.origin||"http://localhost:8080"===e.origin)&&"google-auth-popup"===e.source.name){var t=new XMLHttpRequest,a="/api/session/login/"+e.data;t.open("GET",a,!0),t.onreadystatechange=function(){4===t.readyState&&200===t.status&&"success"===JSON.parse(t.response).status&&window.location.reload()},t.send()}}var e=document.querySelector("#signIn"),i=null,r=null;e&&e.addEventListener("click",function(){!function(e,t){window.removeEventListener("message",n);var a="toolbar=no,menubar=no,width=600,height=700,top=100,left=100";null===i||i.closed?i=window.open(e,t,a):null!==r?(i=window.open(e,t,a)).focus():i.focus(),window.addEventListener("message",n,!1),r=e}(window.__google_auth_url,"google-auth-popup")}),o("#install-template").on("click",function(){o(".modal .modal-title").text("Select a container"),o(".modal .modal-body").empty(),o(".modal .modal-body").html('<img width="450px" src="https://miro.medium.com/max/700/1*CsJ05WEGfunYMLGfsT2sXA.gif" / >'),o.getJSON("/api/gtm/getAccounts",function(e){o(".modal .modal-body").empty();var a=[];a.push("<tr><td>ID</td><td>Name</td></tr>"),o.each(e,function(e,t){a.push("<tr><td>"+t.accountId+"</td><td>"+t.name+"</td></tr>")}),o("#smartwizard").smartWizard({selected:0,theme:"arrows",transitionEffect:"fade",autoAdjustHeight:!0,backButtonSupport:!1,toolbarSettings:{toolbarPosition:"bottom",toolbarExtraButtons:[],showPreviousButton:!1},anchorSettings:{anchorClickable:!1,enableAllAnchors:!1,markDoneStep:!0,enableAnchorOnDoneStep:!0},backButtonSupport:!1,contentCache:!0,disabledSteps:[]})}),o(document).on("leaveStep","#smartwizard",function(e,t,a,n){return"forward"===n&&0===a&&0===o('[name="accountId"]:checked').length?(alert("You need to select an account"),!1):"forward"!==n||1!==a||0!==o('[name="containerId"]:checked').length||(alert("You need to select a container"),!1)}),o("<table/>",{class:"table",html:items.join("")}).appendTo(".modal .modal-body")}),o(document).on("showStep","#smartwizard",function(e,t,a,n){3===a&&(o("#review-account-name").text(o('[name="accountId"]:checked').data("accountName")),o("#review-container-name").html(o('[name="containerId"]:checked').data("containerName")+'<span class="label label-default">'+o('[name="containerId"]:checked').data("containerPublicId")+"</span>"),o(".sw-btn-next").text("INSTALL")),4===a&&o(".sw-btn-next").hide()}),o(document).on("change",'[name="accountId"]',function(){var e=o('[name="accountId"]:checked').val().toString();o('[href="#step-2"]').data("content-url","/api/gtm/getContainers/"+e),o('[href="#step-2"]').attr("data-content-url","/api/gtm/getContainers/"+e)}),o(document).on("change",'[name="containerId"]',function(){var e=o('[name="accountId"]:checked').val().toString(),t=o('[name="containerId"]:checked').val().toString();o('[href="#step-3"]').data("content-url","/api/gtm/getWorkspaces/"+e+"/"+t),o('[href="#step-3"]').attr("data-content-url","/api/gtm/getWorkspaces/"+e+"/"+t)}),o("#exampleModal").on("hidden.bs.modal",function(){o("#smartwizard").smartWizard("reset"),document.location.hash&&-1<document.location.hash.indexOf("#step")&&history.pushState("",document.title,window.location.pathname+window.location.search)})}(window.jQuery);